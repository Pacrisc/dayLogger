


{{if action in ['create', 'update']:}}
    <div id='dl_event_form'>
        {{if action == 'create':}}
        <h3> New event </h3>
        {{elif action == 'update':}}
        <h3> Update event </h3>
        <ul class="breadcrumb">
            <li><a href="{{=URL(c='default', f='index')}}">Home</a></li>
            <li><a href='#'>{{=record.edate.strftime('%d %b %Y')}}</a></li>
            <li>Home</li>
        </ul>
        {{pass}}
        {{=form}}

    <div>
<script type='text/javascript' >
    $(function() {
       $('textarea#events_description').attr('rows', 4)
                                       .removeAttr('cols');
       $('input#events_edate').addClass('input-small')
                              .removeClass('span4');
       $('input#events_etime').addClass('input-small')
                             .removeClass('span4');

        $('#events_id__row').hide();
        $('#events_etime').timepicker();
       // Hacking the default web2py form to put date and time inputs on the same row 
       //$("#dl_event_form #submit_record__row").before("<div id='events_edatetime__row' class='control-group'></div>");
       //$('#events_edatetime__row').html($('#events_edate__row').html() + $('#events_etime__row').html());
    });
</script>

{{elif action == 'show':}}
    <div id='dl_event'>
    <ul class="breadcrumb">
        <li><a href="{{=URL(c='default', f='index')}}">Home</a></li>
        <li><a href='{{=URL(c='default', f='day', args=[record.edate])}}'>{{=record.edate.strftime('%d %b %Y')}}</a></li>
        <li>Current event</li>
    </ul>
            <div class="btn-toolbar dl_crud_toolbar pull-right">
                <div class="btn-group"> 
                    <a class='btn btn-small' href='javascript:void(0);' onclick="ajax('{{=URL(c='default', f='form_wrapper', args=['event', record.id], vars={'a': 'update'}, user_signature=True)}}', [], 'dl_event')">
                        <i class="icon-edit"> </i> Edit </a>
                    <a class='btn btn-small' href='javascript:void(0);' onclick="ajax('{{=URL(c='default', f='event_handler', args=[record.id], vars={'a': 'delete'}, user_signature=True)}}', [], ':eval')">
                        <i class="icon-trash"> </i> Delete </a>
                </div>
            </div>
        <h3 > <button type="button" class="btn btn-info">{{=record.edate.strftime('%d %b %Y')}}  {{=record.etime.strftime('%I:%M %p')}}</button>  {{=record.title}}</h3>
        <div class='auth_info'> 
            <span class='last_modified'> Created {{=prettydate(record.created_on, T)}}, last modified {{=prettydate(record.modified_on, T)}} </span>
        </div/>
        <div id='event_description'>
            {{=record.description}}
        </div>
        <a class='btn btn-small pull-right' href='javascript:void(0);' onclick="ajax('{{=URL(c='default',f='form_wrapper', vars={'a': 'update'}, args=['eventitem' , str(record.id)], user_signature=True)}}', [], 'new_event_item');"> Add items... </a>
        <h5> Event items </h5>

        <div id='new_event_item'>
        </div>
        <ul id='event_items'>
            {{for row in rows:}}
            <li id='event_item_{{=row.id}}'> <span class='ei_description' id='ei_description_{{=row.id}}'> {{=row.description}}</span> - Value: <span class='ei_value' id='ei_value_{{=row.id}}'>{{=row.value}} </span>
           
            <a class='btn btn-mini' href='javascript:void(0);' onclick="ajax('{{=URL(c='default', f='delete_event_item', args=[row.id], user_signature=True)}}', [], ':eval')"> 
                <i class="icon-trash"></i></a>
            </li>
            {{pass}}
        </ul>
        <script type='text/javascript' >
            $(function() {
                    $('.ei_description').editable("{{=URL(c='default', f='jeditable_api')}}",{
                        submit  : 'OK',
                        type : 'textarea',
                        width: 200,
                        rows: 2,
                        cssclass: 'form-inline'
                        });

                    $('.ei_value').editable("{{=URL(c='default', f='jeditable_api')}}",{
                        submit  : 'OK',
                        type : 'text',
                        width: 100,
                        cssclass: 'form-inline'
                        });
            });
        </script>
   
    <div>
{{pass}}
