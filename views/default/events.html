
{{extend 'layout.html'}}

<div class='daylogger'>
{{if action in ['create', 'update']:}}
    <div id='dl_event_form'>
        {{if action == 'create':}}
        <h3> New event </h3>
        {{elif action == 'update':}}
        <h3> Update event </h3>
        <ul class="breadcrumb">
            <li><a href="{{=URL(c='default', f='index')}}">Home</a></li>
            <li><a href='#'>{{=record.edate.strftime('%d %b %Y')}}</a></li>
            <li>Home</li>
        </ul>
        {{pass}}
        {{=form}}

    <div>
<script type='text/javascript' >
    $(function() {
       $('textarea#events_description').attr('rows', 4)
                                       .removeAttr('cols');
       $('input#events_edate').addClass('input-small')
                              .removeClass('span4');
       $('input#events_etime').addClass('input-small')
                             .removeClass('span4');

        $('#events_id__row').hide();
        $('#events_etime').timepicker();
       // Hacking the default web2py form to put date and time inputs on the same row 
       //$("#dl_event_form #submit_record__row").before("<div id='events_edatetime__row' class='control-group'></div>");
       //$('#events_edatetime__row').html($('#events_edate__row').html() + $('#events_etime__row').html());
    });
</script>

{{elif action == 'show':}}
    <div id='dl_event'>
    <ul class="breadcrumb">
        <li><a href="{{=URL(c='default', f='index')}}">Home</a></li>
        <li><a href='{{=URL(c='default', f='day', args=[record.edate])}}'>{{=record.edate.strftime('%d %b %Y')}}</a></li>
        <li>Current event</li>
    </ul>
            <div class="btn-toolbar dl_crud_toolbar pull-right">
                <div class="btn-group"> 
                    <a class='btn btn-small' href='{{=URL(c='default', f='events', args=[record.id], vars={'a': 'clone'})}}'>
                        <i class="icon-edit"></i>Clone</a>
                    <a class='btn btn-small' href='{{=URL(c='default', f='events', args=[record.id], vars={'a': 'update'})}}'>
                        <i class="icon-edit"></i>Edit</a>
                    <a class='btn btn-small' href='javascript:void(0);' onclick="ajax('{{=URL(c='default', f='events', args=[record.id], vars={'a': 'delete'}, user_signature=True)}}', [], ':eval')">
                        <i class="icon-trash"></i> Delete </a>
                </div>
            </div>
        <h3 > <button type="button" class="btn btn-info">{{=record.edate.strftime('%d %b %Y')}}  {{=record.etime.strftime('%I:%M %p')}}</button>  {{=record.title}}</h3>
        <div class='auth_info'> 
            {{if is_admin:}}
            <span class='last_modified'> Created {{=prettydate(record.created_on, T)}} by {{=record.created_by.email}}, last modified {{=prettydate(record.modified_on, T)}} by {{=record.modified_by.email}} </span>
            {{else:}}
            <span class='last_modified'> Created {{=prettydate(record.created_on, T)}}, last modified {{=prettydate(record.modified_on, T)}}</span>
            {{pass}}
        </div/>

        {{if vargs['count']>1:}}
        <div class="alert alert-info" role="alert">Event repeated {{=vargs['count']}} times
            {{if vargs['end_date'] != vargs['begin_date']:}}
              between {{=vargs['begin_date'].strftime('%d %b %Y')}} and {{=vargs['end_date'].strftime('%d %b %Y')}} . 
            {{else:}}
              on {{=vargs['begin_date'].strftime('%d %b %Y')}} .
            {{pass}}
            </div>
        {{else:}}
        <div class="alert alert-info" role="alert">One time event </div>
        {{pass}}

        <div id='event_description'>
            {{=record.description}}
        </div>
        {{=LOAD(c='images', f='uploadimage',vars={'parent_id': record.id}, ajax=False)}}


        {{=LOAD(c='api',f='tags', vars={'table': 'tag_events', 'parent_id': record.id},  user_signature=True, ajax=True)}}
        <a class='btn btn-small pull-right' href='javascript:void(0);' onclick="ajax('{{=URL(c='default',f='form_wrapper', vars={'a': 'update'}, args=['eventitem' , str(record.id)], user_signature=True)}}', [], 'new_event_item');"> Add items... </a>
        <h4> Event items </h4>

        <div id='new_event_item'>
        </div>
        {{if rows:}}
        <div class="alert alert-info" role="alert">To edit an item please click on the corresponding cell below... </div>
        <table id='event_items' class='table table-striped'>
            <thead>
            <tr>
                <th>Description</th>
                <th>Value</th>
                <th>Tags</th>
                <th>Delete</th>
            </tr>
            </thead>
            <tbody>
            {{for row in rows:}}
                <tr id='event_item_{{=row.id}}'>
                    <td class='ei_description' id='ei_description_{{=row.id}}'> {{=row.description}}</td>
                    <td class='ei_value' id='ei_value_{{=row.id}}'>{{=row.value}} </td>
                    <td> {{=LOAD(c='api',f='tags', vars={'table': 'tag_event_items', 'parent_id': row.id},  user_signature=True, ajax=True)}} </td>
                    <td> <a class='btn btn-mini' href='javascript:void(0);' onclick="ajax('{{=URL(c='default', f='delete_event_item', args=[row.id], user_signature=True)}}', [], ':eval')"> 
                <i class="icon-trash"></i></a>
                    </td>
            </tr>
            {{pass}}
            </tbody>
        </table>
        {{pass}}
        <script type='text/javascript' >
            $(function() {
                    $('.ei_description').editable("{{=URL(c='api', f='jeditable')}}",{
                        submit  : 'OK',
                        type : 'textarea',
                        width: 200,
                        rows: 2,
                        cssclass: 'form-inline'
                        });

                    $('.ei_value').editable("{{=URL(c='api', f='jeditable')}}",{
                        submit  : 'OK',
                        type : 'text',
                        //width: 100,
                        cssclass: 'form-inline'
                        });
            });
        </script>
   
    <div>
{{pass}}
</div>
